name: dorothy
"on":
  - push
  - pull_request
jobs:
  test:
    strategy:
      matrix:
        os:
          - ubuntu-latest
    runs-on: ${{ matrix.os }}
    steps:
      - name: "Checkout"
        uses: actions/checkout@v2
      - name: "Prepare"
        shell: bash
        run: |
          export DOROTHY PATH
          DOROTHY="$(pwd)"
          PATH="$DOROTHY/commands:$PATH"
          chmod +x ./commands/*
          # bash -xv ./commands/setup-environment-commands bash
          bash -xv ./commands/expand-path '/home/linuxbrew/.linuxbrew/Cellar/node/*/bin'
          bash -xv ./commands/expand-path '/home/runner/Library/Python/*/bin'
          bash -xv ./commands/expand-path '/home/linuxbrew/.linuxbrew/Cellar/go/*'
      - name: "Configure"
        shell: bash
        run: |
          export DOROTHY
          DOROTHY="$(pwd)"
          ./commands/dorothy dev
        env:
          NO_TTY: yes
          VERBOSE: yes
      - name: "Trunk Check"
        uses: trunk-io/trunk-action@v1.0.0
      - name: "Test"
        shell: bash
        run: |
          export DOROTHY
          DOROTHY="$(pwd)"
          ./commands/dorothy test
        env:
          NO_TTY: yes
          VERBOSE: yes
