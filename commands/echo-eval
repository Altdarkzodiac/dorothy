#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

function echo-eval() (
	# trim internal flags
	while test "$#" -ne 0; do
		if test "$1" = '--'; then
			shift
			break
		else
			shift
		fi
	done

	# ensure there are arguments
	if test "$#" -eq 0; then
		echo-style --error="$0: no command provided" >/dev/stderr
		return 1
	fi

	# echo and run
	local ec
	echo-element --open="$(echo-quote "$@" | echo-join ' ')"
	ec=0 && ("$@") || ec="$?"
	echo-element --close="$(echo-quote "$@" | echo-join ' ')" --status="$ec"
	return "$ec"
)

# fire if invoked standalone
if test "$0" = "${BASH_SOURCE[0]}"; then
	echo-eval "$@"
fi
