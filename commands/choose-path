#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"
source "$DOROTHY/sources/arrays.bash"
requires_array_support 'mapfile' 'empty'

# =====================================
# Arguments

# help
# shellcheck disable=SC2120
function help() {
	cat <<-EOF >/dev/stderr
		ABOUT:
		Select a basename from a series of paths, outputting the selection as an absolute path.

		USAGE:
		choose-path [...flags forwarded to choose-option] -- <...paths>
	EOF
	if test "$#" -ne 0; then
		echo-style $'\n' --error="ERROR:" $'\n' --red="$(echo-lines -- "$@")" >/dev/stderr
	fi
	return 22 # Invalid argument
}

# process
args=()
flags=()
while test "$#" -ne 0; do
	item="$1"
	shift
	case "$item" in
	'help' | '--help' | '-h') help ;;
	'--')
		args+=("$@")
		shift "$#"
		break
		;;
	*) flags+=("$item") ;;
	esac
done

# =====================================
# Action

# adjust args to paths and basenames
mapfile -t values < <(echo-paths-and-basenames "${args[@]}")

# ask with label
choose-option --label "${flags[@]}" -- "${values[@]}"
