#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# @todo: what is the different between contains-string, contains-word, contains-line?

function help() {
	cat <<-EOF >/dev/stderr
		ABOUT:
		Checks whether the <line> is contained in stdin.

		USAGE:
		printf 'one\ntwo\nthree'   | contains-line 'two'      # success
		printf 'one\ntwo\nthree'   | contains-line 'three'    # success
		printf 'one\n\nthree\n'    | contains-line ''         # success
		printf 'one\ntwo\nthree\n' | contains-line ''         # failure

		RETURNS:
		[0] if the line is contained in stdin.
		[1] if the line is not contained in stdin.
	EOF
	if test "$#" -ne 0; then
		echo-style $'\n' --error="ERROR:" $'\n' --red="$(echo-lines -- "$@")" >/dev/stderr
	fi
	return 22 # Invalid argument
}

option_line=''
function arg {
	if test -z "$option_line"; then
		option_line="$1"
	else
		help "An unrecognised argument was provided: $1"
	fi
}
function line {
	if test "$1" = "$option_line"; then
		# it was found, success case, exit immediately
		exit 0
	fi
	# not found, continue reading
}
function finish {
	# it was not found, failure case
	return 1
}

export require_stdin='yes'
function no_args {
	help "Missing <line> argument."
}
function no_stdin {
	help "Missing STDIN to check the <line> against." || :
	return 96 # ENODATA 96 No message available on STREAM
}
source "$DOROTHY/sources/stdinargs.bash"
