#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# help
if is-help "$@"; then
	cat <<-EOF >/dev/stderr
		ABOUT:
		Helper command that prompts for alias file path to be examined.
	EOF
	# if test "$#" -ne 0; then
	# 	echo-style $'\n' --error="ERROR:" $'\n' --red="$(echo-lines -- "$@")" >/dev/stderr
	# fi
	return 22 # Invalid argument
fi

# inputs
path="$(
	ask --required \
		--question="Enter path of the macOS alias file that you want the details for." \
		--default="${1-}"
)"
# @todo if path is a directory, then get details of all aliases inside the directory

# verify
src="$(alias-verify "$path" || :)"
if test -z "$src"; then
	stderr echo-style \
		--bold+red="$path" \
		$'\t' \
		$'\t' --error='← not an alias'
	exit 1
fi

# target
target="$(alias-target "$path" || :)"
if test -z "$target"; then
	stderr echo-style \
		--bold="$src" \
		$'\t' \
		$'\t' --error='← target broken'
	exit 1
fi
if test ! -e "$target"; then
	stderr echo-style \
		--bold="$src" \
		--nocolor=$'\t' --color+dim=$'\t→\t' --bold+red="$target" \
		$'\t' --error='← target missing'
	exit 1
fi

# success
echo-style \
	--bold="$src" \
	--nocolor=$'\t' --color+dim=$'\t→\t' --bold+green="$target"
