#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# https://www.flatpak.org/setup/Ubuntu/
# https://wiki.manjaro.org/index.php/Flatpak

function setup-util-flatpak() (
	# =====================================
	# Checks

	# check that an accident has not occured
	if ! is-linux; then
		echo-style --notice="[$0] is only intended to be run on Linux systems, skipping." >/dev/stderr
		return
	fi

	# check applicability
	if test "${ACTION-}" = 'update' && command-missing flatpak; then
		echo-style --notice="[flatpak] is missing, and we are update only, skipping." >/dev/stderr
		return
	fi

	# =====================================
	# Action

	setup-util "$@" NAME='Flatpak' CLI='flatpak' \
		APT='flatpak' \
		PAMAC='flatpak'

	flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

	if command-exists gnome-software; then
		setup-util "$@" --optional NAME='Flatpak via Gnome Software' \
			APT='gnome-software-plugin-flatpak'
	fi

	flatpak update -y
)

# fire if invoked standalone
if test "$0" = "${BASH_SOURCE[0]}"; then
	setup-util-flatpak "$@"
fi
