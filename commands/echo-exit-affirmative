#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# =====================================
# Arguments

# help
function help() {
	cat <<-EOF >/dev/stderr
		ABOUT:
		Given a command as arguments, execute it, and:
		if [0] was the exit code, output [yes]
		if [1] was the exit code, output [no]
		if anything else was the exit code, propagate that exit code

		USAGE:
		echo-exit-affirmative [--] <command...>

		EXAMPLES:
		echo-exit-affirmative -- exit 0    # outputs: yes    exit code: 0
		echo-exit-affirmative -- exit 1    # outputs: no     exit code: 0
		echo-exit-affirmative -- exit 2    # exit code: 2
	EOF
	if test "$#" -ne 0; then
		echo-style $'\n' --error="ERROR:" $'\n' --red="$(echo-lines -- "$@")" >/dev/stderr
	fi
	return 22 # Invalid argument
}

# process
option_cmd=()
while test "$#" -ne 0; do
	item="$1"
	shift
	case "$item" in
	'help' | '--help' | '-h') help ;;
	'--')
		option_cmd+=("$@")
		shift "$#"
		break
		;;
	*) option_cmd+=("$item") ;;
	esac
done

# check
if test "${#option_cmd[@]}" -eq 0; then
	help "No command was provided."
fi

# =====================================
# Action

function echo_exit_affirmative {
	local ec
	ec=0 && ("$@") || ec="$?"
	if test "$ec" -eq 0; then
		echo 'yes'
	elif test "$ec" -eq 1; then
		echo 'no'
	else
		return "$ec"
	fi
}

# fire if invoked standalone
if test "$0" = "${BASH_SOURCE[0]}"; then
	echo_exit_affirmative "${option_cmd[@]}"
fi
