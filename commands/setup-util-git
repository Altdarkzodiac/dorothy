#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

function setup-util-git() (
	# Git
	# https://git-scm.com/download/linux
	setup-util "$@" NAME='git' CLI='git' \
		APK='git' \
		APT='git' \
		BREW='git' \
		DNF='git' \
		EMERGE='dev-vcs/git' \
		NIX='git' \
		PACMAN='git' \
		PAMAC='git' \
		PKG='git' \
		PKGADD='git' \
		PKGUTIL='git' \
		URPMI='git' \
		YUM='git' \
		ZYPPER='git-core'

	# https://en.wikipedia.org/wiki/OpenSSH
	# @todo figure out the installers for other platforms
	setup-util "$@" --optional NAME='OpenSSH' CLI='sshd' \
		BREW='openssh'

	# Diff/Merge Tool: meld
	# http://meldmerge.org
	# https://yousseb.github.io/meld/
	# https://coderefinery.github.io/installation/difftools/
	setup-util "$@" --confirm --optional NAME='Meld' CLI='meld' \
		APT='meld' \
		DNF='meld' \
		CASK='meld'

	# Diff/Merge Tool: delta
	setup-util-delta "$@" --confirm --optional

	# Diff/Merge Tool: diff
	# https://www.gnu.org/s/diffutils/
	setup-util "$@" --optional CLI='diff' \
		APT='diffutils' \
		BREW='diffutils'

	# Git SSHFS
	# https://en.wikipedia.org/wiki/SSHFS
	setup-util "$@" --optional NAME='SSHFS' CLI='sshfs' \
		APT='sshfs' \
		BREW='sshfs' \
		PACMAN='sshfs'

	# Git LFS
	# https://github.com/git-lfs/git-lfs/blob/main/INSTALLING.md
	setup-util "$@" --optional NAME='Git Large File Storage' CLI='git-lfs' \
		APT='git-lfs' \
		BREW='git-lfs' \
		YUM='git-lfs'

	# GPG
	# https://pkgs.org/download/gnupg
	# on brew, `gpg`, `gp2`, and `gnupg` are all the same
	setup-util "$@" --optional NAME='GnuPG' CLI='gpg' \
		APT='gnupg' \
		BREW='gnupg' \
		PACMAN='gnupg'

	# Pinentry
	# https://www.gnupg.org/related_software/pinentry/
	# https://github.com/GPGTools/pinentry
	# https://gpgtools.org/
	# on brew, `pinentry` replaces `pinentry-mac` and `gpg-suite-pinentry`
	setup-util "$@" --optional NAME='Pinentry' CLI='pinentry' \
		BREW='pinentry'
	# @todo figure out linux options

	# ssh-askpass
	# It could be missing, or called something else on the system
	local target='/usr/lib/ssh/ssh-askpass' files=() file
	if test ! -e "$target"; then
		files=(
			# manjaro/gnome
			'/usr/lib/seahorse/ssh-askpass'
			# arch/gnome
			'/usr/lib/ssh/gnome-ssh-askpass3'
			# arch/minimal
			'/usr/lib/ssh/x11-ssh-askpass'
		)
		file="$(echo-if-executable "${files[@]}" | echo-first)"
		if test -n "$file"; then
			sudo-inherit -- symlink-helper --existing="$file" --symlink="$target"
		fi
	fi

	# Gitell
	setup-util "$@" --optional CLI='gitell' \
		GITHUB_SLUG='deadc0de6/gitell' \
		GITHUB_REF='master' \
		GITHUB_PATHNAME="gitell" \
		GITHUB_FILENAME='gitell'
)

# fire if invoked standalone
if test "$0" = "${BASH_SOURCE[0]}"; then
	setup-util-git "$@"
fi
