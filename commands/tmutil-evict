#!/usr/bin/env bash
source "$DOROTHY/sources/strict.bash"

# =====================================
# Arguments

# help
if is-help-empty "$@"; then
	cat <<-EOF >/dev/stderr
	ABOUT:
	Evict apple time machine cache.
	EOF
	if test "$#" -ne 0; then
		echo-style $'\n' --error="ERROR:" $'\n' --red="$(echo-lines -- "$@")" >/dev/stderr
	fi
	return 22 # Invalid argument
fi

# =====================================
# Act

if is-mac; then
    while read -r snapshot; do
	    sudo tmutil deletelocalsnapshots "$snapshot"
    done < <(tmutil listlocalsnapshotdates | grep '-')
fi
