#!/bin/bash

function newsshkey {
	if is_string "$1"; then
		local name=$1

		local comment=$name
		if is_string "$2"; then
			comment=$2
		fi

		local path="$HOME/.ssh/$name"
		rm -f "$path*"
		echo "Creating new ssh-key at $path with comment $comment"
		ssh-keygen -t rsa -b 4096 -C "$comment" -f "$path"

		# add it to ssh configuration
		# http://stackoverflow.com/a/33228296/130638
		prtinf "\nIdentityFile ~/.ssh/$name" >> "$HOME/.ssh/config"

		# add it to the ssh agent instance
		addsshkey "$name"

		# output the public key so the user can add it to the service
		echo "Public key that you can share is outputted below"
		echo "------------------------------------------------"
		cat "$path.pub"
	else
		echo "newsshkey KEY_NAME [YOUR_EMAIL]"
	fi
}

newsshkey "$@"