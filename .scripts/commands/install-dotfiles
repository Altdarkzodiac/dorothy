#!/usr/bin/env bash
set -e

if test -d "$HOME/.scripts"; then
	echo "skipping clone of dotfiles as they appear to already be there"
else
	echo "cloning the dotfiles into your home directory"
	cd "$HOME"
	git init
	git remote add origin "https://github.com/balupton/dotfiles.git"
	git pull origin master --force
	if test "$USER" = "balupton"; then
		git remote rm origin
		git remote add origin "https://github.com/balupton/dotfiles.git"
		# we do this after the pull to fix permission denied error, as ssh keys has not yet been setup
		# https://github.com/balupton/dotfiles/commit/e5a6fb67edb931834e534b89218bcf97261ca389#diff-68096464afb746771e9f1dee575c2abd
	fi
fi

echo "enforcing correct dotfile permissions"
chmod +x ~/.scripts/commands/*

echo "running dotfile setup command"
~/.scripts/commands/setup-dotfiles

echo "dotfiles installed, open a new terminal to continue..."
exit
