#!/usr/bin/env bash

# Get an Alias Path
# http://stackoverflow.com/a/1330366/130638
function aliasPath {
	osascript 2>/dev/null <<EOF
tell application "Finder"
set theItem to (POSIX file "${1}") as alias
if the kind of theItem is "alias" then
get the posix path of ((original item of theItem) as text)
end if
end tell
EOF
}

# Is an Alias
function isAlias {
	osascript 2>/dev/null <<EOF
tell application "Finder"
set theItem to (POSIX file "${1}") as alias
if the kind of theItem is "alias" then
get the posix path of ((theItem) as text)
end if
end tell
EOF
	}

# Alias
function aliasDetails {
	local src; src=$(isAlias "$1")
	local out; out=$(aliasPath "$1")
	if is_file "$out"; then
		echo "$src -> $out"
	else
		echo "$src -> $out <- missing"
	fi
}

# Alias to Symlink
function aliasToSymlink {
	local src; src=$(isAlias "$1")
	if is_empty_string "$src"; then
		echo "skipped $1"
	else
		local out; out=$(aliasPath "$1")

		if is_file "$out"; then
			ln -nfs "$out" "$src"
			echo "converted $1 -> $out"
		elif is_dir "$out"; then
			ln -nfs "$out" "$src"
			echo "converted $1 -> $out"
		else
			echo "missing $1 -> $out"
		fi
	fi
}
alias symlinks='ls -la | grep ^l'
alias aliases='find ./* | while read file; do aliasDetails "$file"; done'
alias aliasesToSymlink='find ./* | while read file; do aliasToSymlink "$file"; done'

aliasesToSymlink "$@"