#!/usr/bin/env bash
set -e


# Setup system node for global installs and vscode on mac
echo -e "\nInstalling system node..."
if command_exists brew; then
	brew reinstall node
fi

# Configure nvm
if is_dir "$HOME/.nvm"; then
	echo -e "\nUpdating nvm..."
	cd "$HOME/.nvm"
	git checkout master
	git pull origin master
	cd "$HOME"
else
	echo -e "\nInstalling nvm..."
	git clone git://github.com/creationix/nvm.git "$HOME/.nvm"
fi

# Add nvm to the path of this bash script
# prevents the need for a full login shell
source "$HOME/.scripts/sources/nvm.bash"

echo -e "\nInstalling latest nvm node version..."
nvm install node
nvm alias default node

echo -e "\nSwitching back to system node version..."
nvm use system

echo ''; if confirm "Install global system npm packages?"; then
	npm install -g npm
	npm install -g bevry-base ci-watch live-server npm-check-updates typescript yarn
	# https://github.com/yarnpkg/yarn/issues/2993#issuecomment-289703085
fi
